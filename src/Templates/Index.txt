<?php

/**
 * Load the Composer Autoloader
 */

require realpath('vendor') . '/autoload.php';

/**
 * Add constant variable for application path
 */

define('APPPATH', realpath(__DIR__) . '/app/');

/**
 * Import the Slytherin namespace
 */

use Pux\Mux;
use Rougin\Slytherin\Application;
use Rougin\Slytherin\View;
use Whoops\Handler\PrettyPageHandler;
use Whoops\Run;

/**
 * This is where you can change the environment
 * of your application. You can choose from "development" and
 * "production".
 *
 * According to Patrick Louys, never show any errors in your
 * production environment. A stack trace or even just a
 * simple error message can help someone to gain access to
 * your system. Always show a user friendly error page
 * instead and send an email to yourself, write to a log or
 * something similar. So only you can see the errors in the
 * production environment.
 *
 * References:
 * https://github.com/filp/whoops
 * https://github.com/PatrickLouys/no-framework-tutorial/blob/master/03-error-handler.md
 */

error_reporting(E_ALL);

$environment = 'development';

/**
* Register the error handler
*/

$whoops = new Run;

if ($environment !== 'production') {
	$whoops->pushHandler(new PrettyPageHandler);
} else {
	$whoops->pushHandler(function ($error) {
		echo View::render('404');
	});
}

$whoops->register();

/**
 * Load Pux's Mux (https://github.com/c9s/Pux)
 */

$route = new Mux();

/**
 * Initialize and run Slytherin
 */

$app = new Application($route);
$app->run();